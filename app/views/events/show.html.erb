<!--  This file is app/views/events/show.html.erb -->
<h2>Details about <em><%= @event.title %></em></h2>

<ul id="details">
  <li>
    🗣&nbsp;<b>Host</b>
    &nbsp;<%= link_to @event.host, user_path(@host) %>
  </li>
  <li>
    ✏️&nbsp;<b>Host Rating</b>
    &nbsp;
    <% (@host.rating.nil? ? 5 : @host.rating).times do %>
      ⭐️
    <% end %>
  </li>
  <li>
    📅&nbsp;<b>Event Time</b>
    &nbsp;<%= @event.event_time.nil? ? "TBD" : @event.event_time.strftime("%m-%d-%Y") %>
  </li>
  <li>
    ⏳&nbsp;<b>Event Status</b>
    &nbsp;<%= @event.status %>
  </li>
  <li>
    🧐&nbsp;<b>Maximum Number of Attendees</b>
    &nbsp;<%= @event.attendee_limit %>
  </li>
  <li>
    <% if @event.people.length < 6 %>
      👥&nbsp;<b>Attending People</b>
      &nbsp;
      <% @event.people.each do |person| %>
        <%= link_to person, user_path(@attendees.fetch(person)) %>&nbsp;&nbsp;&nbsp;
      <% end %>
    <% else %>
      👥&nbsp;<b>Attending People</b>
      <details>
        <summary>Click to view all attendees</summary>
        <% @event.people.each do |person| %>
          <%= link_to person, user_path(@attendees.fetch(person)) %>&nbsp;&nbsp;&nbsp;
        <% end %>
      </details>
    <% end %>
  </li>
</ul>

<h3>Description:</h3>
<p id="description">
  <%= @event.description %>
</p>
<br>

<div class="row">
  <% if @is_viewer_host %>
    <%= link_to 'Edit', edit_event_path(@event), :class => 'btn btn-primary col-2' %>
    <%= link_to 'Delete', event_path(@event), 'data-method' => 'delete', 'data-confirm' => 'Are you sure?', :class => 'btn btn-danger col-2' %>
    
    <% if @event.status == "closed" %>
      <%= link_to 'Rate your attendees', rate_path(@event, @is_viewer_host), :class => @rate_btn_style %>
    <% end %>

  <% end %>
  <%= link_to 'Back to event list', events_path, :class => 'btn btn-primary col-2' %>
  <%# Join: if user is not host && there's space %>
  <% if !@is_viewer_host %>
  <%= link_to @join_text, join_path({:id=>@event.id}), :class => @join_btn_style, :id => 'join_btn'%>
  
    <% if @event.status == "closed" && @is_user_joined %>
        <%= link_to 'Rate your host', rate_path(@event, @is_viewer_host), :class => @rate_btn_style %>
    <% end %>

  <% end %>
</div>
<br>

<br>
<h3 class="details_padding">📒Comments </h3>
<table class="table table-striped col-md-12" id="comments">
  <thead>
    <tr>
      <th>👤User</th>
      <th>🖊️Comment</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @event.comments.each do |comment| %>
      <tr>
        <td>
          <%= comment.user.username %>
        </td>
        <td>
          <%= comment.content %>
        </td>
        <td>
          <% if comment.user.username == @username %>
            <%= link_to 'Edit', edit_event_comment_path(@event, comment.id), :class => 'btn btn-secondary col-4' %>
            <%= link_to 'Delete', event_comment_path(@event, comment.id), 'data-method' => 'delete', 'data-confirm' => 'Are you sure?', :class => 'btn btn-danger col-4' %>
          <% end %>
        </td>
      </tr>
      <tr>
        <td>
          <div class="row">
            <div class="col-md-2">
              <%= button_to '', react_path(@event, comment.id, 0), :method => :put, :id => 'thumbup' %>
            </div>
            <div class="col-md-2">
              <%= button_to '', react_path(@event, comment.id, 1), :method => :put, :id => "like" %>
            </div>
            <div class="col-md-2">
              <%= button_to '', react_path(@event, comment.id, 2), :method => :put, :id => "laugh" %>
            </div>
          </div>
        </td>
        <% if comment.reactions.count_reacts(comment.id)>0 %>
          <td>
            <% comment.reactions.find_people(comment.id).each do |name| %>
              <%= name + ", " %>
            <% end %>
            <span>and others</span>
          </td>
          <td>
            <%= comment.reactions.count_reacts(comment.id) %>
            <span> Reactions</span>
          </td>
        <% else %>
          <td>
            <span>👈 Be the first one to react</span>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<%= form_tag event_comments_path(@event), :class => 'form' do %>
  <%= label :comment, '', :class => 'col-form-label' %>
  <%= text_field :comment, :content, :class => 'form-control', placeholder: 'Leave a quick comment (length limit: 100)', maxlength: 100 %>
  <br>
  <%= submit_tag 'Post Comment', :class => 'btn btn-primary' %>
<% end %>
